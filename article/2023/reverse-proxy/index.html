<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=author content="白菜"><meta property="og:url" content="https://blog.baicai.me/article/2023/reverse-proxy/"><link rel=canonical href=https://blog.baicai.me/article/2023/reverse-proxy/><style type=text/css>body{font-family:monospace}</style><title>搭建反向代理服务：Telegram Bot Api 反向代理搭建</title>
<meta name=description content="一个勤奋的代码搬运工!"><meta name=author content="白菜"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href="/css/baicai_custom.css?rnd=1743157893"></head><body><header>============<br>== <a href=https://blog.baicai.me/>白菜</a> ==<br>============<div style=float:right>一个勤奋的代码搬运工!</div><br><p><nav><a href=/><b>Start</b></a>.
<a href=/posts/><b>文章</b></a>.
<a href=/categories/><b>分类</b></a>.
<a href=/tags/><b>标签</b></a>.
<a href=/about/><b>关于</b></a>.</nav></p></header><main><article><h1>搭建反向代理服务：Telegram Bot Api 反向代理搭建</h1><b><time>2023.09.20 12:06</time></b>
<a href=/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB>技术分享</a>
<a href=/tags/nginx>nginx</a>
<a href=/tags/proxy>proxy</a>
<a href=/tags/telegram>telegram</a><div><p>上面一篇通过nginx和cloudflare workers 搭建的反向代理。</p><p>这一篇通过更简单的代码重下搭建个。</p><h2 id=通过-cloudflare-workers-搭建反向代理服务>通过 Cloudflare Workers 搭建反向代理服务</h2><p>创建 Cloudflare workers 的步骤都是一样的，代码不一样。</p><h3 id=创建一个worker>创建一个Worker</h3><p>在首页选择Workers，若从未创建过则初始化，选择免费套餐，然后创建一个Worker。</p><h3 id=编辑worker内容>编辑Worker内容</h3><p>进入worker，点击快速编辑，将代码改为下方内容，其中hostname改为你自己的，然后点击保存部署，并可改名为例如cdn的worker。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// 这就是需要代理的网址
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hostname</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://example.domain&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// const hostname = &#34;http://192.168.0.1&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>// const hostname = &#34;https://your.domain&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>// const hostname = &#34;https://your.domain/api/path&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>request</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Request</span>(<span style=color:#a6e22e>hostname</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>,<span style=color:#a6e22e>request</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;fetch&#34;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(<span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>))
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><h3 id=为域名添加dns>为域名添加DNS</h3><p>添加路由，配置</p><pre tabindex=0><code class=language-cn.you.domain/* data-lang=cn.you.domain/*></code></pre><p>指向步骤1创建的 Worker，到此等待DNS生效即可。</p><h2 id=通过-vercel-搭建反向代理服务>通过 Vercel 搭建反向代理服务</h2><p>在github中新建个项目
创建一个文件，命名为 vercel.json 文件内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;routes&#34;</span>: [
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/.*&#34;</span>, <span style=color:#f92672>&#34;dest&#34;</span>: <span style=color:#e6db74>&#34;https://example.domain&#34;</span>}
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>进入 vercel 后台 部署这个项目 配置好自定义域名，即可使用。</p><p>通用代理 json 内容 参考：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;routes&#34;</span>: [
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/redirect&#34;</span>, <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#ae81ff>308</span>, <span style=color:#f92672>&#34;headers&#34;</span>: { <span style=color:#f92672>&#34;Location&#34;</span>: <span style=color:#e6db74>&#34;https://example.domain/&#34;</span> } },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/custom-page&#34;</span>, <span style=color:#f92672>&#34;headers&#34;</span>: {<span style=color:#f92672>&#34;cache-control&#34;</span>: <span style=color:#e6db74>&#34;s-maxage=1000&#34;</span>}, <span style=color:#f92672>&#34;dest&#34;</span>: <span style=color:#e6db74>&#34;/index.html&#34;</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/api&#34;</span>, <span style=color:#f92672>&#34;dest&#34;</span>: <span style=color:#e6db74>&#34;/my-api.js&#34;</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/users&#34;</span>, <span style=color:#f92672>&#34;methods&#34;</span>: [<span style=color:#e6db74>&#34;POST&#34;</span>], <span style=color:#f92672>&#34;dest&#34;</span>: <span style=color:#e6db74>&#34;/users-api.js&#34;</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/users/(?&lt;id&gt;[^/]*)&#34;</span>, <span style=color:#f92672>&#34;dest&#34;</span>: <span style=color:#e6db74>&#34;/users-api.js?id=$id&#34;</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/legacy&#34;</span>, <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#ae81ff>404</span>},
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;src&#34;</span>: <span style=color:#e6db74>&#34;/.*&#34;</span>, <span style=color:#f92672>&#34;dest&#34;</span>: <span style=color:#e6db74>&#34;https://example.domain/&#34;</span>}
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=通过nginx-对网站进行反向代理>通过Nginx 对网站进行反向代理</h2><h3 id=创建配置文件>创建配置文件</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano /etc/nginx/conf.d/tgapi.conf
</span></span></code></pre></div><p>输入一下内容并保存</p><pre tabindex=0><code class=language-conf data-lang=conf>server {
    listen 80;
    server_name tgapi.domain;
    location / {
       return 444;
    }
    location ~* ^/bot {
        resolver 8.8.8.8;
        proxy_buffering off;
        proxy_pass      https://example.domain$request_uri;
    }
}
</code></pre></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/article/2025/the_degree_confluence_project/>访问世界上每一个经纬度为整数的交叉点</a></li><li><a href=/article/2025/test_25/>测试服务器能否正常收发邮件</a></li><li><a href=/article/2025/nginx_too_many_open_files/>Nginx 出现 Too many open files 错误与修复</a></li><li><a href=/article/2025/ifconfig_interfaces/>Debian12 系统添加多个IP</a></li><li><a href=/article/2025/linux_curl/>linux测试url的访问速度</a></li></ul></div></div></aside><footer><p>&copy; 2025 <a href=https://blog.baicai.me/><b>baicai.me</b></a>.
<a href=/links/><b>友情链接</b></a>.
<a href=/index.xml><b>RSS</b></a>.</p></footer></body></html>