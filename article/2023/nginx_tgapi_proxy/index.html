<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=author content="白菜"><meta property="og:url" content="https://blog.baicai.me/article/2023/nginx_tgapi_proxy/"><link rel=canonical href=https://blog.baicai.me/article/2023/nginx_tgapi_proxy/><style type=text/css>body{font-family:monospace}</style><title>Telegram Bot Api 反向代理搭建</title>
<meta name=author content="白菜"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href="/css/baicai_custom.css?rnd=1740152708"></head><body><header>============<br>== <a href=https://blog.baicai.me/>白菜</a> ==<br>============<div style=float:right>一个勤奋的代码搬运工!</div><br><p><nav><a href=/><b>Start</b></a>.
<a href=/posts/><b>文章</b></a>.
<a href=/categories/><b>分类</b></a>.
<a href=/tags/><b>标签</b></a>.
<a href=/about/><b>关于</b></a>.</nav></p></header><main><article><h1>Telegram Bot Api 反向代理搭建</h1><b><time>2023.09.19 22:28</time></b>
<a href=/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB>技术分享</a>
<a href=/tags/nginx>nginx</a>
<a href=/tags/proxy>proxy</a>
<a href=/tags/telegram>telegram</a><div><p>由于一些原因，配置epusdt需要使用tg反向代理地址才能使用！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span><span style=color:#75715e>#telegram代理url(大陆地区服务器可使用一台国外服务器做反代tg的url)，如果运行的本来就是境外服务器，则无需填写</span>
</span></span><span style=display:flex><span>tg_proxy<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>两种实现方案，根据个人喜好选择使用或发挥</p><h2 id=nginx反代telegram-api>Nginx反代Telegram Api</h2><h3 id=安装nginx>安装nginx</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install -y nginx
</span></span></code></pre></div><h3 id=创建配置文件>创建配置文件</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano tgapi.conf
</span></span></code></pre></div><p>输入一下内容并保存</p><pre tabindex=0><code class=language-conf data-lang=conf>server {
    listen 80;
    server_name tgapi.domain;
    location / {
       return 444;
    }
    location ~* ^/bot {
        resolver 8.8.8.8;
        proxy_buffering off;
        proxy_pass      https://api.telegram.org$request_uri;
    }
}
</code></pre><h3 id=加载配置>加载配置</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl reload nginx
</span></span><span style=display:flex><span><span style=color:#75715e>#或</span>
</span></span><span style=display:flex><span>sudo nginx -s reload
</span></span></code></pre></div><h3 id=测试访问>测试访问</h3><p>输入以下命令行,BOT_TOKEN换成自己机器人token。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://tgapi.domain/bot&lt;BOT_TOKEN&gt;/getMe
</span></span></code></pre></div><p>看的机器人信息，就说明可以使用了。</p><h3 id=配置-epusdt-telegram代理url>配置 epusdt telegram代理url</h3><p>epusdt 配置(.env)参考</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span><span style=color:#75715e>#telegram代理url(大陆地区服务器可使用一台国外服务器做反代tg的url)，如果运行的本来就是境外服务器，则无需填写</span>
</span></span><span style=display:flex><span>tg_proxy<span style=color:#f92672>=</span>https://tgapi.domain
</span></span></code></pre></div><h3 id=docker-配置-nginx-参考-docker-composeyam-内容>docker 配置 nginx 参考 docker-compose.yam 内容</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#e6db74>&#34;nginx&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:bookworm</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./conf.d:/etc/nginx/conf.d</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./log:/var/log/nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>extra_hosts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;host.docker.internal:host-gateway&#34;</span>
</span></span></code></pre></div><h2 id=使用-cloudflare-worker-代理-telegram-bot-api>使用 Cloudflare Worker 代理 Telegram Bot Api</h2><p>使用前提</p><ol><li>一个托管在cloudflare的域名</li><li>k开启cloudflare的免费worker服务</li></ol><h3 id=首先登录cloudflare以后点击左侧的workers-和-pages>首先登录Cloudflare以后点击左侧的Workers 和 Pages</h3><p>点击 <code>创建应用程序</code>-<code>创建 worker</code></p><p><code>名称</code> 随意填写，点击 <code>部署</code></p><p>创建完成后，点击刚创建的Worker，再点击 <code>快速编辑</code></p><p>在左侧删除原有的代码，填入下面给出的代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Helper functions to check if the request uses
</span></span></span><span style=display:flex><span><span style=color:#75715e> * corresponding method.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Method</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>method</span>) =&gt; (<span style=color:#a6e22e>req</span>) =&gt; <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span>.<span style=color:#a6e22e>toLowerCase</span>() <span style=color:#f92672>===</span> <span style=color:#a6e22e>method</span>.<span style=color:#a6e22e>toLowerCase</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Get</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Method</span>(<span style=color:#e6db74>&#39;get&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Method</span>(<span style=color:#e6db74>&#39;post&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Path</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>regExp</span>) =&gt; (<span style=color:#a6e22e>req</span>) =&gt; {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>regExp</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>regExp</span>)[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>===</span> <span style=color:#a6e22e>path</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e> * The regex to get the bot_token and api_method from request URL
</span></span></span><span style=display:flex><span><span style=color:#75715e> * as the first and second backreference respectively.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>URL_PATH_REGEX</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/^\/bot(?&lt;bot_token&gt;[^/]+)\/(?&lt;api_method&gt;[a-z]+)/i</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Router handles the logic of what handler is matched given conditions
</span></span></span><span style=display:flex><span><span style=color:#75715e> * for each request
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Router</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>routes</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>handle</span>(<span style=color:#a6e22e>conditions</span>, <span style=color:#a6e22e>handler</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>routes</span>.<span style=color:#a6e22e>push</span>({
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>conditions</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>handler</span>,
</span></span><span style=display:flex><span>		});
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>handler</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>handle</span>([<span style=color:#a6e22e>Get</span>, <span style=color:#a6e22e>Path</span>(<span style=color:#a6e22e>url</span>)], <span style=color:#a6e22e>handler</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>post</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>handler</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>handle</span>([<span style=color:#a6e22e>Post</span>, <span style=color:#a6e22e>Path</span>(<span style=color:#a6e22e>url</span>)], <span style=color:#a6e22e>handler</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>all</span>(<span style=color:#a6e22e>handler</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>handler</span>([], <span style=color:#a6e22e>handler</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>route</span>(<span style=color:#a6e22e>req</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>route</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>req</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>route</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>route</span>.<span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>req</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>description</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;No matching route found&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>error_code</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>ok</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>error_code</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>description</span>,
</span></span><span style=display:flex><span>			}),
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error_code</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>statusText</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>description</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>					<span style=color:#e6db74>&#39;content-type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>				},
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * It returns the matching route that returns true
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * for all the conditions if any.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>req</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>routes</span>.<span style=color:#a6e22e>find</span>((<span style=color:#a6e22e>r</span>) =&gt; {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conditions</span> <span style=color:#f92672>||</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>r</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conditions</span>.<span style=color:#a6e22e>length</span>)) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conditions</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;function&#39;</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conditions</span>(<span style=color:#a6e22e>req</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conditions</span>.<span style=color:#a6e22e>every</span>((<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>(<span style=color:#a6e22e>req</span>));
</span></span><span style=display:flex><span>		});
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Sends a POST request with JSON data to Telegram Bot API
</span></span></span><span style=display:flex><span><span style=color:#75715e> * and reads in the response body.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Request} request the incoming request
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Extract the URl method from the request.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>url</span>, ...<span style=color:#a6e22e>_request</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>pathname</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>search</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Leave the first match as we are interested only in backreferences.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>bot_token</span>, <span style=color:#a6e22e>api_method</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>URL_PATH_REGEX</span>).<span style=color:#a6e22e>groups</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Build the URL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api_url</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://api.telegram.org/bot&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>bot_token</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>api_method</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>search</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Get the response from API.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>api_url</span>, <span style=color:#a6e22e>_request</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>text</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>_request</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Content-Type&#39;</span>, <span style=color:#e6db74>&#39;application/json&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Handles the incoming request.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Request} request the incoming request.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Router</span>();
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>URL_PATH_REGEX</span>, (<span style=color:#a6e22e>req</span>) =&gt; <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>req</span>));
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>post</span>(<span style=color:#a6e22e>URL_PATH_REGEX</span>, (<span style=color:#a6e22e>req</span>) =&gt; <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>req</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>resp</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>route</span>(<span style=color:#a6e22e>request</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resp</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Hook into the fetch event.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;fetch&#39;</span>, (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(<span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>));
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><code>保存并部署</code></p><p>回到管理后台首页，点击左侧的<code>网站</code>，在右侧点击<code>你已托管在Cloudflare的域名</code></p><p>选择该域名下的 <code>Workers 路由</code></p><p>选择<code>添加路由</code></p><p><code>路由</code> 填写你想要用的二级域名，比如：<code>tgapi.domain/*</code> 注意后面必须是<code>/*</code>结尾，<code>Worker</code>选择刚才创建的服务，<code>保存</code>就可以了。</p></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/article/2025/ifconfig_interfaces/>Debian12 系统添加多个IP</a></li><li><a href=/article/2025/linux_curl/>linux测试url的访问速度</a></li><li><a href=/article/2025/giffgaff_wificall/>Giffgaff 打开 wificall 的操作步骤及分流规则</a></li><li><a href=/article/2024/docker_export_import_save_load/>Docker本地镜像的导出、导入 (export,import,save,load)</a></li><li><a href=/article/2024/fmt_int/>Go语言进制以及进制转换</a></li></ul></div></div></aside><footer><p>&copy; 2025 <a href=https://blog.baicai.me/><b>baicai.me</b></a>.
<a href=/links/><b>友情链接</b></a>.
<a href=/index.xml><b>RSS</b></a>.</p></footer></body></html>