<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=author content="白菜"><meta property="og:url" content="https://blog.baicai.me/article/2023/delete_pod/"><link rel=canonical href=https://blog.baicai.me/article/2023/delete_pod/><style type=text/css>body{font-family:monospace}</style><title>Kubernetes 停止和移除 pod</title>
<meta name=author content="白菜"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href="/css/baicai_custom.css?rnd=1727159439"></head><body><header>============<br>== <a href=https://blog.baicai.me/>白菜</a> ==<br>============<div style=float:right>一个勤奋的代码搬运工!</div><br><p><nav><a href=/><b>Start</b></a>.
<a href=/posts/><b>文章</b></a>.
<a href=/categories/><b>分类</b></a>.
<a href=/tags/><b>标签</b></a>.
<a href=/about/><b>关于</b></a>.</nav></p></header><main><article><h1>Kubernetes 停止和移除 pod</h1><b><time>2023.11.20 16:02</time></b>
<a href=/tags/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB>技术分享</a>
<a href=/tags/k3s>k3s</a>
<a href=/tags/kubectl>kubectl</a><div><h2 id=停止和移除pod>停止和移除pod</h2><h3 id=按名称删除pod>按名称删除pod</h3><p>按名称删除kubia-gpu pod：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete po kubia-gpu
</span></span></code></pre></div><p>在删除pod的过程中，实际上我们在指示Kubernetes终止该pod中的所有容器。Kubernetes向进程发送一个SIGTERM信号并等待一定的秒数（默认为30），使其正常关闭。如果它没有及时关闭，则通过SIGKILL终止该进程。因此，为了确保你的进程总是正常关闭，进程需要正确处理SIGTERM信号。</p><h4 id=提示>提示</h4><p>还可以通过指定多个空格分隔的名称来删除多个pod（例如：kubectl delete po pod1 pod2）。</p><h3 id=使用标签选择器删除pod>使用标签选择器删除pod</h3><p>停止 kubia-manual 和 kubia-manual-v2 pod 。这两个pod都包含标签 <code>creation_method=manual</code> ，因此可以通过使用一个标签选择器来删除它们：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete po -l creation_method<span style=color:#f92672>=</span>manual
</span></span></code></pre></div><h3 id=通过删除整个命名空间来删除pod>通过删除整个命名空间来删除pod</h3><p>以下命令删除custom-namespace：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete ns custom-namespace
</span></span></code></pre></div><h3 id=删除命名空间中的所有pod但保留命名空间>删除命名空间中的所有pod，但保留命名空间</h3><p>查看 pods</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>通过使用&ndash;all选项告诉Kubernetes删除当前命名空间中的所有pod：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete po --all
</span></span></code></pre></div><h3 id=删除命名空间中的几乎所有资源>删除命名空间中的（几乎）所有资源</h3><p>通过使用单个命令删除当前命名空间中的所有资源，可以删除ReplicationCcontroller和pod，以及我们创建的所有service：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete all --all
</span></span></code></pre></div><p>命令中的第一个all指定正在删除所有资源类型，而&ndash;all选项指定将删除所有资源实例，而不是按名称指定它们（我们在运行前一个删除命令时已经使用过此选项）。</p><h4 id=注意>注意</h4><p>使用all关键字删除所有内容并不是真的完全删除所有内容。一些资源会被保留下来，并且需要被明确指定删除。</p><p>删除资源时，kubectl将打印它删除的每个资源的名称。</p><h4 id=注意-1>注意</h4><p><code>kubectl delete all --all</code> 命令也会删除名为kubernetes的Service，但它应该会在几分钟后自动重新创建。</p><h2 id=kubectl-命令演示>kubectl 命令演示</h2><h3 id=kubectl-展示搜索出的pod列表含pod所在的namespace>kubectl 展示搜索出的pod列表（含pod所在的namespace）</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pod -A |grep &lt;podname&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@node ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pod -A |grep dashboard</span>
</span></span><span style=display:flex><span>kubernetes-dashboard   dashboard-metrics-scraper-5657497c4c-j5kr8   1/1     Running   <span style=color:#ae81ff>0</span>              113m
</span></span><span style=display:flex><span>kubernetes-dashboard   kubernetes-dashboard-78f87ddfc-tlmjv         1/1     Running   <span style=color:#ae81ff>0</span>              113m
</span></span></code></pre></div><h3 id=kubectl-删除pod命令>kubectl 删除pod命令</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod &lt;podname&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><p>在进行删除pod命令时，会发现pod并未被真正删除，原因是k8s误认为我们要删除的pod异常挂了，会启用容灾机制，导致重新在拉起一个新的pod。
故，我们想要正常且彻底的删除一个pod，必须要先破坏掉他的容灾机制，即删除deployment机制。</p><h3 id=查看deployment信息>查看deployment信息</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get deployment -n &lt;namespace&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@debian ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get deployment  --all-namespaces</span>
</span></span><span style=display:flex><span>NAMESPACE              NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>kube-system            coredns                     2/2     <span style=color:#ae81ff>2</span>            <span style=color:#ae81ff>2</span>           4h7m
</span></span><span style=display:flex><span>kubernetes-dashboard   dashboard-metrics-scraper   1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           117m
</span></span><span style=display:flex><span>kubernetes-dashboard   kubernetes-dashboard        1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           117m
</span></span></code></pre></div><h3 id=删除deployment配置>删除deployment配置</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete deployment &lt;deployment名&gt; -n &lt;namespace&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@node ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl delete deployment  kubernetes-dashboard -n kubernetes-dashboard</span>
</span></span><span style=display:flex><span>deployment.apps <span style=color:#e6db74>&#34;kubernetes-dashboard&#34;</span> deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@node ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl delete deployment  dashboard-metrics-scraper -n kubernetes-dashboard</span>
</span></span><span style=display:flex><span>deployment.apps <span style=color:#e6db74>&#34;dashboard-metrics-scraper&#34;</span> deleted
</span></span></code></pre></div><h3 id=然后进行删除pod命令即可我删除deployment后再次查询pod发现上面的pod已经开始自行删除了这步可酌情处理>然后进行删除pod命令即可，我删除deployment后，再次查询pod发现，上面的pod已经开始自行删除了（这步可酌情处理）</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod &lt;podname&gt; -n &lt;namespace&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@node ~<span style=color:#f92672>]</span><span style=color:#75715e># delete pod dashboard-metrics-scraper-5657497c4c-j5kr8 -n kubernetes-dashboard</span>
</span></span><span style=display:flex><span>pod <span style=color:#e6db74>&#34;dashboard-metrics-scraper-5657497c4c-j5kr8&#34;</span> deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 附一个我这边删除deployment后pod自行删除的情况</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@node ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pod -A|grep dashboard</span>
</span></span></code></pre></div></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/article/2024/cmd_sqlite/>Mac终端查看sqlite3数据库</a></li><li><a href=/article/2024/debian_ufw_docker/>解决 UFW 和 Docker 的问题</a></li><li><a href=/article/2024/docker_ports/>docker 映射某个范围内的端口列表</a></li><li><a href=/article/2024/adb_push_pull/>使用adb命令和电脑互传文件</a></li><li><a href=/article/2024/find_subdomain/>查找子域名解析: 子域名探测方法大全</a></li></ul></div></div></aside><footer><p>&copy; 2024 <a href=https://blog.baicai.me/><b>baicai.me</b></a>.
<a href=/links/><b>友情链接</b></a>.
<a href=/index.xml><b>RSS</b></a>.</p></footer></body></html>